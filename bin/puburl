#!/usr/bin/cl -Q -s quri -E main

(defvar *base-url* "http://files.joram.io/")

(defun main (argv)
  (if argv
      (handler-case
          (let* ((path (truename (parse-namestring (first argv))))
                 ;; The directory we should be in is /home/joram/public. We skip the
                 ;; initial :ABSOLUTE as well as those three directory parts.
                 (directory (mapcar #'quri:url-encode
                                    (cddddr (pathname-directory path))))
                 (name (when (pathname-name path)
                         (quri:url-encode (pathname-name path))))
                 (type (when (pathname-type path)
                         (quri:url-encode (pathname-type path)))))
            (format t "~a~{~a/~}~@[~a~@[.~a~]~]~%"
                    *base-url*
                    directory
                    name
                    type))
        (serious-condition (c)
          (format t "There's something wrong with that path of yours: ~%~A~%" c)))
      (format t "~a~%" *base-url*)))
